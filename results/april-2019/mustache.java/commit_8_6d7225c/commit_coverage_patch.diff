diff --git a/compiler/src/main/java/com/github/mustachejava/codes/ExtendCode.java b/compiler/src/main/java/com/github/mustachejava/codes/ExtendCode.java
index 4a3be58..9edef3e 100644
--- a/compiler/src/main/java/com/github/mustachejava/codes/ExtendCode.java
+++ b/compiler/src/main/java/com/github/mustachejava/codes/ExtendCode.java
@@ -1,6 +1,10 @@
 package com.github.mustachejava.codes;
 
-import com.github.mustachejava.*;
+import com.github.mustachejava.Code;
+import com.github.mustachejava.DefaultMustacheFactory;
+import com.github.mustachejava.Mustache;
+import com.github.mustachejava.MustacheException;
+import com.github.mustachejava.TemplateContext;
 
 import java.util.HashMap;
 import java.util.HashSet;
@@ -61,8 +65,8 @@ public class ExtendCode extends PartialCode {
         ExtendNameCode erc = (ExtendNameCode) code;
         replaceMap.put(erc.getName(), erc);
         erc.init();
-      } else if (code instanceof WriteCode) {
-        // ignore text
+      } else if ((code instanceof WriteCode) || (code instanceof CommentCode)) {
+        // ignore text and comments
       } else {
         // fail on everything else
         throw new IllegalArgumentException(
diff --git a/compiler/src/test/java/com/github/mustachejava/functions/CommentTest.java b/compiler/src/test/java/com/github/mustachejava/functions/CommentTest.java
index cf57302..27f8918 100644
--- a/compiler/src/test/java/com/github/mustachejava/functions/CommentTest.java
+++ b/compiler/src/test/java/com/github/mustachejava/functions/CommentTest.java
@@ -4,10 +4,14 @@ import com.github.mustachejava.DefaultMustacheFactory;
 import com.github.mustachejava.Mustache;
 import com.github.mustachejava.MustacheException;
 import com.github.mustachejava.MustacheFactory;
+
 import org.junit.BeforeClass;
 import org.junit.Test;
 
-import java.io.*;
+import java.io.File;
+import java.io.IOException;
+import java.io.StringWriter;
+import java.util.Collections;
 import java.util.HashMap;
 import java.util.Map;
 import java.util.concurrent.ExecutionException;
@@ -30,6 +34,26 @@ public class CommentTest {
     assertEquals(getContents(root, "comment.txt"), sw.toString());
   }
 
+  @Test
+  public void testCommentInline() throws MustacheException, IOException, ExecutionException, InterruptedException {
+    MustacheFactory c = new DefaultMustacheFactory(root);
+    Mustache m = c.compile("commentInline.html");
+    StringWriter sw = new StringWriter();
+    Map scope = new HashMap();
+    scope.put("title", "A Comedy of Errors");
+    m.execute(sw, scope);
+    assertEquals(getContents(root, "commentInline.txt"), sw.toString());
+  }
+
+  @Test
+  public void testInlineCommentWithinExtendCodeBlock() throws MustacheException, IOException, ExecutionException, InterruptedException {
+    MustacheFactory c = new DefaultMustacheFactory(root);
+    Mustache m = c.compile("commentWithinExtendCodeBlock.html");
+    StringWriter sw = new StringWriter();
+    m.execute(sw, Collections.emptyList());
+    assertEquals(getContents(root, "commentWithinExtendCodeBlock.txt"), sw.toString());
+  }
+
   @BeforeClass
   public static void setUp() throws Exception {
     File file = new File("compiler/src/test/resources/functions");
diff --git a/compiler/src/test/resources/functions/commentWithinExtendCodeBlock.html b/compiler/src/test/resources/functions/commentWithinExtendCodeBlock.html
new file mode 100644
index 0000000..572e74b
--- /dev/null
+++ b/compiler/src/test/resources/functions/commentWithinExtendCodeBlock.html
@@ -0,0 +1,6 @@
+{{<commentWithinExtendCodeBlock_sub}}
+
+  {{! just something interesting... or not... }}
+  {{$title}}Just for the fun of it{{/title}}
+
+{{/commentWithinExtendCodeBlock_sub}}
\ No newline at end of file
diff --git a/compiler/src/test/resources/functions/commentWithinExtendCodeBlock.txt b/compiler/src/test/resources/functions/commentWithinExtendCodeBlock.txt
new file mode 100644
index 0000000..8b7225b
--- /dev/null
+++ b/compiler/src/test/resources/functions/commentWithinExtendCodeBlock.txt
@@ -0,0 +1 @@
+<h1>Just for the fun of it</h1>
diff --git a/compiler/src/test/resources/functions/commentWithinExtendCodeBlock_sub.html b/compiler/src/test/resources/functions/commentWithinExtendCodeBlock_sub.html
new file mode 100644
index 0000000..901f509
--- /dev/null
+++ b/compiler/src/test/resources/functions/commentWithinExtendCodeBlock_sub.html
@@ -0,0 +1 @@
+<h1>{{$title}}{{/title}}{{! just something interesting... or not... }}</h1>
diff --git a/compiler/src/test/resources/functions/commentinline.html b/compiler/src/test/resources/functions/commentinline.html
new file mode 100644
index 0000000..5036801
--- /dev/null
+++ b/compiler/src/test/resources/functions/commentinline.html
@@ -0,0 +1 @@
+<h1>{{title}}{{! just something interesting... or not... }}</h1>
diff --git a/compiler/src/test/resources/functions/commentinline.txt b/compiler/src/test/resources/functions/commentinline.txt
new file mode 100644
index 0000000..0133517
--- /dev/null
+++ b/compiler/src/test/resources/functions/commentinline.txt
@@ -0,0 +1 @@
+<h1>A Comedy of Errors</h1>
