package org.xwiki.extension.job.internal;


import java.util.Arrays;
import java.util.Collection;
import org.junit.Assert;
import org.junit.Test;
import org.xwiki.extension.InstalledExtension;
import org.xwiki.extension.TestResources;
import org.xwiki.extension.job.plan.ExtensionPlan;
import org.xwiki.extension.job.plan.ExtensionPlanAction;
import org.xwiki.extension.job.plan.ExtensionPlanNode;
import org.xwiki.extension.job.plan.internal.DefaultExtensionPlan;
import org.xwiki.extension.repository.internal.installed.DefaultInstalledExtension;
import org.xwiki.extension.test.AbstractExtensionHandlerTest;
import org.xwiki.job.Request;
import org.xwiki.job.event.status.JobProgress;
import org.xwiki.job.event.status.JobProgressStep;


public class AmplUpgradePlanJobTest extends AbstractExtensionHandlerTest {
    @Test(timeout = 10000)
    public void testUpgradePlanOnRoot_add49996_add62829() throws Throwable {
        InstalledExtension extension = ((DefaultInstalledExtension) (install(TestResources.REMOTE_UPGRADE10_ID)));
        InstalledExtension o_testUpgradePlanOnRoot_add49996__4 = this.installedExtensionRepository.installExtension(extension, null, true);
        ExtensionPlan plan = upgradePlan();
        int o_testUpgradePlanOnRoot_add49996__9 = plan.getTree().size();
        ExtensionPlanNode node = getNode(TestResources.REMOTE_UPGRADE20_ID, plan.getTree());
        ExtensionPlanAction action = node.getAction();
        action.getExtension().getId();
        action.getExtension().getId();
        action.getExtension().getId();
        action.getAction();
        action.getAction();
        action.getAction();
        action.getNamespace();
        action.getNamespace();
        action.getNamespace();
        action.getNamespace();
        action.getNamespace();
        action.getNamespace();
        int o_testUpgradePlanOnRoot_add49996__20 = node.getChildren().size();
        ExtensionPlanNode o_testUpgradePlanOnRoot_add49996__22 = getNode(TestResources.INSTALLED_WITHMISSINDEPENDENCY_ID, plan.getTree());
        node = getNode(TestResources.INSTALLED_WITHMISSINDEPENDENCY_ID, plan.getTree());
        action = node.getAction();
        int o_testUpgradePlanOnRoot_add49996__32 = action.getPreviousExtensions().size();
        int o_testUpgradePlanOnRoot_add49996__36 = node.getChildren().size();
        node = node.getChildren().iterator().next();
        action = node.getAction();
        int o_testUpgradePlanOnRoot_add49996__47 = action.getPreviousExtensions().size();
        int o_testUpgradePlanOnRoot_add49996__49 = action.getPreviousExtensions().size();
        int o_testUpgradePlanOnRoot_add49996__54 = node.getChildren().size();
        int o_testUpgradePlanOnRoot_add49996__56 = node.getChildren().size();
        int o_testUpgradePlanOnRoot_add49996__58 = plan.getActions().size();
        int o_testUpgradePlanOnRoot_add49996__60 = upgradePlan(null, Arrays.asList(TestResources.REMOTE_UPGRADE10_ID, TestResources.INSTALLED_WITHMISSINDEPENDENCY_ID)).getTree().size();
        int o_testUpgradePlanOnRoot_add49996__64 = upgradePlan(null, Arrays.asList(TestResources.REMOTE_UPGRADE10_ID)).getTree().size();
        ExtensionPlan o_testUpgradePlanOnRoot_add49996_add62829__94 = upgradePlan(null, Arrays.asList(TestResources.REMOTE_UPGRADE20_ID));
        Assert.assertEquals("[REPAIR: installedwithmissingdependency/version (null) ([INSTALL: missingdependency/version (null) ([], version)]), UPGRADE: upgrade/2.0 (null, [upgrade/1.0]) ([])]", ((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).toString());
        Assert.assertFalse(((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getActions().isEmpty());
        Assert.assertFalse(((Collection) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getTree())).isEmpty());
        Assert.assertNull(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getRequest())).getId());
        Assert.assertNull(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getRequest())).isStatusSerialized());
        Assert.assertFalse(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getRequest())).isRemote());
        Assert.assertFalse(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getRequest())).isInteractive());
        Assert.assertFalse(((Collection) (((Request) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getRequest())).getPropertyNames())).isEmpty());
        Assert.assertTrue(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getRequest())).isVerbose());
        Assert.assertNull(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getRequest())).isStatusLogIsolated());
        Assert.assertNull(((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getProgress())).getCurrentStep())).getParent());
        Assert.assertEquals(1.0, ((double) (((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getProgress())).getCurrentStep())).getOffset())), 0.1);
        Assert.assertFalse(((Collection) (((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getProgress())).getCurrentStep())).getChildren())).isEmpty());
        Assert.assertEquals(1.0, ((double) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getProgress())).getCurrentLevelOffset())), 0.1);
        Assert.assertEquals(1.0, ((double) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getProgress())).getOffset())), 0.1);
        Assert.assertNull(((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getProgress())).getRootStep())).getParent());
        Assert.assertEquals(1.0, ((double) (((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getProgress())).getRootStep())).getOffset())), 0.1);
        Assert.assertFalse(((Collection) (((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getProgress())).getRootStep())).getChildren())).isEmpty());
        Assert.assertEquals("upgradeplan", ((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getJobType());
        Assert.assertTrue(((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).isSerialized());
        Assert.assertTrue(((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).isIsolated());
        Assert.assertFalse(((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).isSubJob());
        Assert.assertNull(((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getParentJobStatus());
        Assert.assertFalse(((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).isCancelable());
        Assert.assertFalse(((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).isCanceled());
        Assert.assertNull(((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getError());
        Assert.assertFalse(((Collection) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getLog())).isEmpty());
        int o_testUpgradePlanOnRoot_add49996__68 = upgradePlan(null, Arrays.asList(TestResources.REMOTE_UPGRADE20_ID)).getTree().size();
        Assert.assertEquals("[REPAIR: installedwithmissingdependency/version (null) ([INSTALL: missingdependency/version (null) ([], version)]), UPGRADE: upgrade/2.0 (null, [upgrade/1.0]) ([])]", ((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).toString());
        Assert.assertFalse(((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getActions().isEmpty());
        Assert.assertFalse(((Collection) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getTree())).isEmpty());
        Assert.assertNull(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getRequest())).getId());
        Assert.assertNull(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getRequest())).isStatusSerialized());
        Assert.assertFalse(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getRequest())).isRemote());
        Assert.assertFalse(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getRequest())).isInteractive());
        Assert.assertFalse(((Collection) (((Request) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getRequest())).getPropertyNames())).isEmpty());
        Assert.assertTrue(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getRequest())).isVerbose());
        Assert.assertNull(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getRequest())).isStatusLogIsolated());
        Assert.assertNull(((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getProgress())).getCurrentStep())).getParent());
        Assert.assertEquals(1.0, ((double) (((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getProgress())).getCurrentStep())).getOffset())), 0.1);
        Assert.assertFalse(((Collection) (((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getProgress())).getCurrentStep())).getChildren())).isEmpty());
        Assert.assertEquals(1.0, ((double) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getProgress())).getCurrentLevelOffset())), 0.1);
        Assert.assertEquals(1.0, ((double) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getProgress())).getOffset())), 0.1);
        Assert.assertNull(((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getProgress())).getRootStep())).getParent());
        Assert.assertEquals(1.0, ((double) (((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getProgress())).getRootStep())).getOffset())), 0.1);
        Assert.assertFalse(((Collection) (((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getProgress())).getRootStep())).getChildren())).isEmpty());
        Assert.assertEquals("upgradeplan", ((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getJobType());
        Assert.assertTrue(((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).isSerialized());
        Assert.assertTrue(((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).isIsolated());
        Assert.assertFalse(((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).isSubJob());
        Assert.assertNull(((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getParentJobStatus());
        Assert.assertFalse(((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).isCancelable());
        Assert.assertFalse(((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).isCanceled());
        Assert.assertNull(((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getError());
        Assert.assertFalse(((Collection) (((DefaultExtensionPlan) (o_testUpgradePlanOnRoot_add49996_add62829__94)).getLog())).isEmpty());
    }
}

