package org.xwiki.extension.job.internal;


import java.util.Collection;
import org.junit.Assert;
import org.junit.Test;
import org.xwiki.extension.InstalledExtension;
import org.xwiki.extension.TestResources;
import org.xwiki.extension.job.plan.ExtensionPlan;
import org.xwiki.extension.job.plan.ExtensionPlanAction;
import org.xwiki.extension.job.plan.ExtensionPlanNode;
import org.xwiki.extension.job.plan.internal.DefaultExtensionPlan;
import org.xwiki.extension.test.AbstractExtensionHandlerTest;
import org.xwiki.job.Request;
import org.xwiki.job.event.status.JobProgress;
import org.xwiki.job.event.status.JobProgressStep;


public class AmplUpgradePlanJobTest extends AbstractExtensionHandlerTest {
    @Test(timeout = 10000)
    public void testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331() throws Throwable {
        InstalledExtension o_testUpgradePlanWithDependencyOnRoot_add24711__1 = install(TestResources.REMOTE_UPGRADEWITHDEPENDENCY10_ID);
        ExtensionPlan o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5 = upgradePlan();
        Assert.assertEquals("[UPGRADE: upgrade-withdependency/2.0 (null, [upgrade-withdependency/1.0]) ([UPGRADE: upgrade/2.0 (null, [upgrade/1.0]) ([], 2.0)]), REPAIR: installedwithmissingdependency/version (null) ([INSTALL: missingdependency/version (null) ([], version)])]", ((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).toString());
        Assert.assertFalse(((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getActions().isEmpty());
        Assert.assertFalse(((Collection) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getTree())).isEmpty());
        Assert.assertEquals("upgradeplan", ((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getJobType());
        Assert.assertNull(((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getError());
        Assert.assertFalse(((Collection) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getLog())).isEmpty());
        Assert.assertFalse(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getRequest())).isInteractive());
        Assert.assertFalse(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getRequest())).isRemote());
        Assert.assertFalse(((Collection) (((Request) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getRequest())).getPropertyNames())).isEmpty());
        Assert.assertTrue(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getRequest())).isVerbose());
        Assert.assertNull(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getRequest())).isStatusSerialized());
        Assert.assertNull(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getRequest())).isStatusLogIsolated());
        Assert.assertNull(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getRequest())).getId());
        Assert.assertFalse(((Collection) (((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getProgress())).getCurrentStep())).getChildren())).isEmpty());
        Assert.assertNull(((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getProgress())).getCurrentStep())).getParent());
        Assert.assertEquals(1.0, ((double) (((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getProgress())).getCurrentStep())).getOffset())), 0.1);
        Assert.assertEquals(1.0, ((double) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getProgress())).getCurrentLevelOffset())), 0.1);
        Assert.assertFalse(((Collection) (((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getProgress())).getRootStep())).getChildren())).isEmpty());
        Assert.assertNull(((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getProgress())).getRootStep())).getParent());
        Assert.assertEquals(1.0, ((double) (((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getProgress())).getRootStep())).getOffset())), 0.1);
        Assert.assertEquals(1.0, ((double) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getProgress())).getOffset())), 0.1);
        Assert.assertTrue(((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).isSerialized());
        Assert.assertTrue(((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).isIsolated());
        Assert.assertFalse(((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).isSubJob());
        Assert.assertNull(((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getParentJobStatus());
        Assert.assertFalse(((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).isCancelable());
        Assert.assertFalse(((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).isCanceled());
        ExtensionPlan plan = upgradePlan();
        plan.getTree();
        int o_testUpgradePlanWithDependencyOnRoot_add24711__7 = plan.getTree().size();
        ExtensionPlanNode node = getNode(TestResources.REMOTE_UPGRADEWITHDEPENDENCY20_ID, plan.getTree());
        ExtensionPlanAction action = node.getAction();
        action.getExtension().getId();
        action.getAction();
        action.getNamespace();
        int o_testUpgradePlanWithDependencyOnRoot_add24711__19 = node.getChildren().size();
        ExtensionPlanNode childNode = node.getChildren().iterator().next();
        ExtensionPlanAction childAction = childNode.getAction();
        childAction.getExtension().getId();
        childAction.getAction();
        childAction.getNamespace();
        node = getNode(TestResources.INSTALLED_WITHMISSINDEPENDENCY_ID, plan.getTree());
        action = node.getAction();
        action.getExtension().getId();
        action.getAction();
        int o_testUpgradePlanWithDependencyOnRoot_add24711__40 = action.getPreviousExtensions().size();
        action.getNamespace();
        action.getNamespace();
        int o_testUpgradePlanWithDependencyOnRoot_add24711__44 = node.getChildren().size();
        int o_testUpgradePlanWithDependencyOnRoot_add24711_add38301__56 = node.getChildren().size();
        int o_testUpgradePlanWithDependencyOnRoot_add24711__46 = node.getChildren().size();
        node = node.getChildren().iterator().next();
        action = node.getAction();
        action.getExtension().getId();
        action.getAction();
        int o_testUpgradePlanWithDependencyOnRoot_add24711__57 = action.getPreviousExtensions().size();
        int o_testUpgradePlanWithDependencyOnRoot_add24711__59 = action.getPreviousExtensions().size();
        action.getNamespace();
        action.getNamespace();
        action.getNamespace();
        int o_testUpgradePlanWithDependencyOnRoot_add24711__64 = node.getChildren().size();
        int o_testUpgradePlanWithDependencyOnRoot_add24711__66 = plan.getActions().size();
        Assert.assertEquals("[UPGRADE: upgrade-withdependency/2.0 (null, [upgrade-withdependency/1.0]) ([UPGRADE: upgrade/2.0 (null, [upgrade/1.0]) ([], 2.0)]), REPAIR: installedwithmissingdependency/version (null) ([INSTALL: missingdependency/version (null) ([], version)])]", ((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).toString());
        Assert.assertFalse(((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getActions().isEmpty());
        Assert.assertFalse(((Collection) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getTree())).isEmpty());
        Assert.assertEquals("upgradeplan", ((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getJobType());
        Assert.assertNull(((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getError());
        Assert.assertFalse(((Collection) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getLog())).isEmpty());
        Assert.assertFalse(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getRequest())).isInteractive());
        Assert.assertFalse(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getRequest())).isRemote());
        Assert.assertFalse(((Collection) (((Request) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getRequest())).getPropertyNames())).isEmpty());
        Assert.assertTrue(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getRequest())).isVerbose());
        Assert.assertNull(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getRequest())).isStatusSerialized());
        Assert.assertNull(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getRequest())).isStatusLogIsolated());
        Assert.assertNull(((Request) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getRequest())).getId());
        Assert.assertFalse(((Collection) (((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getProgress())).getCurrentStep())).getChildren())).isEmpty());
        Assert.assertNull(((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getProgress())).getCurrentStep())).getParent());
        Assert.assertEquals(1.0, ((double) (((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getProgress())).getCurrentStep())).getOffset())), 0.1);
        Assert.assertEquals(1.0, ((double) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getProgress())).getCurrentLevelOffset())), 0.1);
        Assert.assertFalse(((Collection) (((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getProgress())).getRootStep())).getChildren())).isEmpty());
        Assert.assertNull(((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getProgress())).getRootStep())).getParent());
        Assert.assertEquals(1.0, ((double) (((JobProgressStep) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getProgress())).getRootStep())).getOffset())), 0.1);
        Assert.assertEquals(1.0, ((double) (((JobProgress) (((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getProgress())).getOffset())), 0.1);
        Assert.assertTrue(((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).isSerialized());
        Assert.assertTrue(((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).isIsolated());
        Assert.assertFalse(((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).isSubJob());
        Assert.assertNull(((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).getParentJobStatus());
        Assert.assertFalse(((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).isCancelable());
        Assert.assertFalse(((DefaultExtensionPlan) (o_testUpgradePlanWithDependencyOnRoot_add24711_add38301_add41331__5)).isCanceled());
    }
}

